- # 改善前的准备工作

  每个程序员都将需要重构现有的代码。但在这样做之前，请考虑以下几点，这可以节省您和其他人大量的时间（和痛苦）：

  - *重构的最佳方法是先盘点现有代码库以及针对该代码编写的测试。* 这将帮助您了解代码目前的优缺点，以便您确保保留强项，同时避免错误。我们都认为自己可以比现有系统做得更好……直到我们最终得到的东西不如以前的版本好，甚至更糟，因为我们没有从现有系统的错误中吸取教训。
  - *避免重写所有代码的诱惑。* 尽可能重用现有代码。无论代码有多丑陋，它已经经过测试、评审等。抛弃旧代码——特别是如果它已经在生产中——意味着您正在抛弃经过数月（或数年）的测试、打磨的代码，可能有某些您不知道的解决方法和漏洞修复。如果您没有考虑这一点，您编写的新代码可能会显示出旧代码中曾经修复的相同神秘错误。这将浪费很多时间、精力和多年的知识。
  - *多个增量更改比一个大更改好。* 增量更改可通过反馈（如测试）更轻松地评估对系统的影响。做出更改后看到一百个测试失败并不好玩。这可能导致挫败感和压力，反过来会导致糟糕的决策。几个测试失败很容易处理，并提供了一种更可管理的方法。
  - *每次迭代后，确保现有的测试通过。* 如果现有测试不足以涵盖您所做的更改，请添加新测试。不要轻易丢弃旧代码的测试。表面上，其中一些测试可能看起来与您的新设计不适用，但深入挖掘添加该特定测试的原因是值得的。
  - *个人偏好和自我中心不应成为障碍。* 如果某些东西没有出现问题，为什么要改变它？代码的风格或结构不符合您的个人偏好并不是重构的有效原因。认为自己可以比以前的程序员做得更好也不是有效原因。
  - *新技术不是重构的充分理由。* 重构的最差理由之一是因为当前代码落后于我们今天所拥有的所有新技术，我们相信新的语言或框架可以更优雅地完成工作。除非成本效益分析表明新的语言或框架将在功能性、可维护性或生产力方面带来显著的改进，否则最好将其保持原样。
  - *记住人会犯错。* 重构并不总能保证新代码会比以前更好 - 甚至不能保证与以前尝试的代码一样好。我见过并参与了几次失败的重构尝试。这并不美观，但这是人性的表现。


by [Rajith Attapattu](http://programmer.97things.oreilly.com/wiki/index.php/Rajith_Attapattu)