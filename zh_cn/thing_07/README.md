# 当心共享

这是我在公司的第一个项目。我刚刚完成了学位，渴望证明自己，每天都加班研究现有代码。在完成我的第一个功能时，我特别注意了我所学到的一切——注释、日志、将共享代码提取到可能的库中等等。我曾经觉得准备充分的代码审查让我感到很惊讶——重复使用被反对了！

这怎么可能？在整个大学期间，重复使用一直被认为是高质量软件工程的典范。所有我所读的文章、教科书、教授我的资深软件专业人士。这一切都是错的吗？

事实证明，我漏掉了一些至关重要的东西。

上下文。

两个系统中极为不同的部分以相同的方式执行某些逻辑意味着的意义比我想象的要小。在我提取出那些共享代码库之前，这些部分之间没有互相依赖。每个部分可以独立发展。每个部分可以根据系统不断变化的业务环境更改其逻辑。这四行类似代码是偶然的——一个时间上的异常，一个巧合。直到我来了之后。

我创建的共享代码库将每只脚的鞋带系在了一起。一个业务域的步骤不能在与另一个业务域同步之前进行。独立函数的维护成本曾经可以忽略不计，但共同的库需要多达一个数量级的测试。

虽然我减少了系统中代码的绝对行数，但我增加了依赖项的数量。这些依赖项的上下文是至关重要的——如果它们被局部化，那么这样做可能是合理的并且具有一些积极价值。当这些依赖项没有受到限制时，它们的卷须会缠绕系统的更大问题，即使代码本身看起来很好。

这些错误是隐匿的，因为它们在本质上听起来像一个好主意。在正确的上下文中应用这些技术是有价值的。在错误的上下文中，它们增加了成本而不是价值。当进入一个没有关于各个部分将被使用的上下文的现有代码库时，我现在对共享的内容更加小心谨慎。

当心共享。检查你的上下文。只有在这之后，才可以继续。

作者：[Udi Dahan](http://programmer.97things.oreilly.com/wiki/index.php/Udi_Dahan)